!function (t) { var e = {}; function n(i) { if (e[i]) return e[i].exports; var o = e[i] = { i: i, l: !1, exports: {} }; return t[i].call(o.exports, o, o.exports, n), o.l = !0, o.exports } n.m = t, n.c = e, n.d = function (t, e, i) { n.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: i }) }, n.r = function (t) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(t, "__esModule", { value: !0 }) }, n.t = function (t, e) { if (1 & e && (t = n(t)), 8 & e) return t; if (4 & e && "object" == typeof t && t && t.__esModule) return t; var i = Object.create(null); if (n.r(i), Object.defineProperty(i, "default", { enumerable: !0, value: t }), 2 & e && "string" != typeof t) for (var o in t) n.d(i, o, function (e) { return t[e] }.bind(null, o)); return i }, n.n = function (t) { var e = t && t.__esModule ? function () { return t.default } : function () { return t }; return n.d(e, "a", e), e }, n.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, n.p = "", n(n.s = 0) }([function (t, e, n) { "use strict"; n.r(e); class i { constructor() { this.collapseAllExpandedCells(), this.bindToInlineEditingCell() } mutateCell(t) { if (!t.hasClass("expanded-cell")) { const e = t.outerWidth(), n = 2 * e; let i; i = e > 440 ? e : n > 440 ? 440 : n; const o = 3 * t.outerHeight(), a = o > 256 ? 256 : o; t.addClass("expanded-cell"), t.css("width", i + "px"), t.css("height", a + "px") } } revertCell(t) { t.hasClass("expanded-cell") && (t.removeClass("expanded-cell"), t.css("width", "inherit"), t.css("height", "inherit")) } bindToInlineEditingCell() { this.collapseAllExpandedCells(), $(".expandable-cell").each((t, e) => { const n = $(e), i = n.find("textarea"); $(i).on("mouseup", t => { 0 === t.button && this.mutateCell(n) }), $(i).on("blur", () => { this.revertCell(n) }) }) } collapseAllExpandedCells() { $("expanded-cell").each((t, e) => { $(e).removeClass("expanded-cell") }) } } class o { constructor(t, e, n) { const i = t, o = this.createInfoTooltipContentContainer(e); this.createTooltip(o, i, n), this.removeWhenMouseNotOver(i, o) } createTooltip(t, e, n) { document.body.appendChild(t), this.popper = new Popper(e, t, n) } removeWhenMouseNotOver(t, e) { $(document).on("mouseover", n => { n.target !== t && e.remove() }) } createInfoTooltipContentContainer(t) { const e = document.createElement("div"); return e.classList = ["info-tooltip-content p-4"], e.innerText = t, e } } class a { constructor() { this.bindToInfoTooltipClass() } bindToInfoTooltipClass() { $(document).on("mouseover", function (t) { $(t.target).hasClass("info-tooltip") && new o(t.target, $(t.target).data("content"), { placement: "bottom-start" }) }) } } class r { constructor() { this.bindToCollapseControls(), this.bindToCollapseParentButton(), function () { const t = $('[data-toggle="collapse"]'); $(t).each((t, e) => { const n = $(e).attr("data-target"); $(n).on("hide.bs.collapse", t => { !function t(e) { const n = $(e); const i = n.find('[data-toggle="collapse"]'); i && 0 !== i.length && i.each((e, n) => { const i = $(n).attr("data-target"); t(n), $(i).collapse("hide") }) }(t.target) }) }) }(), $('[data-collapse-linked="true"]').each((t, e) => { const n = $(e); n.on("show.bs.collapse", t => { !function (t) { t = $(t), $('[data-collapse-linked="true"]').each((e, n) => { const i = $(n); i !== t && i.collapse("hide") }) }(t.target) }) }) } static expandCollapse(t) { $(t).each((t, e) => { $(e).find(".collapse").first().collapse("show") }) } bindToCollapseControls() { $("#collapse-all").on("click", () => { $(".collapse").each((t, e) => { const n = $(e); n.hasClass("spoiler-collapse") || n.collapse("show") }) }), $("#hide-all").on("click", () => { $(".collapse").each((t, e) => { const n = $(e); n.hasClass("spoiler-collapse") || n.collapse("hide") }) }) } bindToCollapseParentButton() { $(".collapse-parent").each((t, e) => { $(e).on("click", () => { $(e).parents(".collapse").first().collapse("hide") }) }) } } var s, c = function () { function t(t, e, n) { this.target = t, this.element = e, this.positioningOptions = n, this.container = e, this.componentAppending(), this.componentRemoving() } return t.prototype.componentAppending = function () { return $(document.body).append(this.element), this.popper = new Popper(this.target, this.container, this.positioningOptions), this.target }, t.prototype.componentRemoving = function () { var t = this; $(document).on("mouseup", function (e) { $(t.container).is(e.target) || 0 !== $(t.container).has(e.target).length || (t.container.remove(), delete t.element, delete t.popper) }) }, t }(), l = function () { function t(t) { this.componentOptions = t, this.addButton = null, this.container = this.getContainer(), this.searchBar = this.getSearchBar(), this.componentBody = this.getComponentBody() } return t.prototype.getSearchBar = function () { return $('<div class="search-bar">\n                            <input type="text" placeholder="' + this.componentOptions.searchBarPlaceholder + '">\n                            <span class="material-icons bg-transparent">search</span>\n                        </div>')[0] }, t.prototype.getComponentBody = function () { return $('<div class="dynamic-select-body"></div>')[0] }, t.prototype.getAddButton = function () { return $('<div class="add-item">\n                    <div class="add-container">\n                        ' + this.componentOptions.addButtonLabel + '\n                    </div>\n                    <span class="material-icons">add</span>\n                </div>')[0] }, t.prototype.getContainer = function () { return $('<div class="dynamic-select"></div>')[0] }, t }(), d = (s = function (t, e) { return (s = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(t, e) }, function (t, e) { function n() { this.constructor = t } s(t, e), t.prototype = null === e ? Object.create(e) : (n.prototype = e.prototype, new n) }), p = function (t) { function e(e, n, i) { var o = t.call(this, n) || this; return o.isThereAnExactMatchForItem = null, o.valuesArray = e, o.actionPromises = i, o.items = o.getItems(), o } return d(e, t), e.prototype.assemble = function () { var t = this; this.container.appendChild(this.searchBar), this.items.forEach(function (e) { t.componentBody.appendChild(e) }), this.container.appendChild(this.componentBody) }, e.prototype.handleActions = function () { var t = this; this.handleSearchInput(), this.items.forEach(function (e, n) { t.handleItemEvents(e, n) }) }, e.prototype.getComponent = function () { return this.assemble(), this.handleActions(), this.container }, e.prototype.handleItemSelect = function (t) { var e = this; t.on("click", function (n) { var i, o = $(n.target); if ((o.is(".item") || o.is("input")) && t.find("input:text").length) { if (t.hasClass("editing-item")) return; if (e.currentlyEditedItem) return void e.revertCurrentlyEditedItem(); i = t.attr("data-id"), e.emitSelectedValue(i), e.container.remove() } }) }, e.prototype.handleItemEvents = function (t, e) { var n = $(t), i = n.find("input").first(), o = n.find('[data-role="edit"]').first(), a = n.find('[data-role="accept"]').first(), r = n.find('[data-role="delete"]').first(), s = n.find('[data-role="undo"]').first(); this.handleItemDelete(r, e, n), this.handleItemEdit({ editButton: o, acceptButton: a, deleteButton: r, undoButton: s }, i, n), this.handleItemSave({ editButton: o, acceptButton: a, deleteButton: r, undoButton: s }, i, e, n), this.handleItemRevert(s), this.handleItemSelect(n) }, e.prototype.handleItemDelete = function (t, e, n) { var i = this; t.on("click", function () { i.disableItemEditing(), n.addClass("deleting-item"), i.actionPromises.delete(i.valuesArray[e], i.componentOptions).then(function () { n[0].remove() }).catch(function () { n.removeClass("deleting-item") }) }) }, e.prototype.handleItemSave = function (t, e, n, i) { var o = this; t.acceptButton.on("click", function () { i.addClass("saving-item"); var a = { id: o.valuesArray[n].id, value: e.val().toString().trim() }; o.actionPromises.update(a, o.componentOptions).then(function () { o.disableItemEditing(), t.acceptButton.blur(), o.inputInitialValue = null }).catch(function () { o.enableItemEditing(i, e) }).finally(function () { i.removeClass("saving-item") }) }) }, e.prototype.handleItemRevert = function (t) { var e = this; t.on("click", function () { e.revertCurrentlyEditedItem(), t.blur() }) }, e.prototype.handleSearchInput = function () { var t = this; $(this.searchBar).on("keyup", function (e) { var n = $(e.currentTarget).find("input"), i = n.val().toString().trim().toLowerCase(), o = $(t.componentBody); t.isThereAnExactMatchForItem = !1; var a = 0; o.find(".item:not(.add-item)").filter(function (t, e) { var n = $(e), o = n.find("input:text").val(), r = o.toString().toLowerCase().indexOf(i) > -1; return o.toString().toLowerCase() === i && a++ , r ? n.removeClass("display-none") : n.addClass("display-none"), null }), t.isThereAnExactMatchForItem = !!a, t.appendAddButton(n, i) }) }, e.prototype.handleActionAdd = function (t) { var e = this; if (this.addButton) { var n = $(this.addButton); n.on("click", function () { var i = t.val().toString().toLowerCase().trim(); e.actionPromises.create(i, e.componentOptions).then(function (t) { var o = e.getItem({ id: t, value: i, checked: !1 }), a = { id: t, value: i, checked: !1 }, r = e.items.push(o); n.addClass("saving-item"), e.valuesArray.push(a), e.componentBody.appendChild(o), e.handleItemEvents(o, r), e.addButton.remove() }).catch(function () { return n.removeClass("saving-item") }) }) } }, e.prototype.revertCurrentlyEditedItem = function () { var t = $(this.currentlyEditedItem).find("input"); this.inputInitialValue && t.val(this.inputInitialValue), this.disableItemEditing() }, e.prototype.disableItemEditing = function () { if (this.currentlyEditedItem) { var t = this.currentlyEditedItem.find("input").first(); t.blur(), document.getSelection().removeAllRanges(), t.attr("readonly", "readonly"), this.currentlyEditedItem.removeClass("editing-item"), this.currentlyEditedItem = null } }, e.prototype.emitSelectedValue = function (t) { $(this.container).trigger("selectValueChange", { value: t, options: this.componentOptions }) }, e.prototype.getItem = function (t) { var e = this.actionPromises.update ? '<button data-role="edit" class="mr-1"><span class="material-icons">edit</span></button>\n               <button data-role="accept" class="editing-only mr-1" style="display: none;">\n                   <span class="material-icons">checked</span>\n               </button>\n               <button data-role="undo" class="editing-only" style="display: none;">\n                   <span class="material-icons">replay</span>\n               </button>' : "", n = this.actionPromises.delete ? '<button data-role="delete"><span class="material-icons">clear</span></button>' : "", i = '<div class="item" data-id="' + t.id + '">\n                    <input type="text" style="width: 80%;" readonly value="' + t.value + '">\n                    ' + e + "\n                    " + n + "\n                    </div>"; return $(i)[0] }, e.prototype.getItems = function () { var t = this, e = []; return this.valuesArray.forEach(function (n) { var i = t.getItem(n); e.push(i) }), e }, e.prototype.appendAddButton = function (t, e) { this.actionPromises.create && (!this.isThereAnExactMatchForItem && e.trim().length ? this.addButton || (this.addButton = this.getAddButton(), this.componentBody.prepend(this.addButton), this.handleActionAdd(t)) : null !== this.addButton && (this.addButton.remove(), this.addButton = null)) }, e.prototype.handleItemEdit = function (t, e, n) { var i = this; t.editButton.on("click", function () { i.inputInitialValue = e.val().toString(), i.enableItemEditing(n, e) }) }, e.prototype.enableItemEditing = function (t, e) { this.disableItemEditing(), this.currentlyEditedItem = t, t.addClass("editing-item"), e.removeAttr("readonly"), e.select() }, e }(l), u = function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function i() { this.constructor = e } t(e, n), e.prototype = null === n ? Object.create(n) : (i.prototype = n.prototype, new i) } }(), h = function (t) { function e(e, n, i) { var o = t.call(this, n) || this; return o.isThereAnExactMatchForItem = null, o.valuesArray = e, o.actionPromises = i, o.items = o.getItems(), o } return u(e, t), e.prototype.assemble = function () { var t = this; this.container.appendChild(this.searchBar), this.items.forEach(function (e) { t.componentBody.appendChild(e) }), this.container.appendChild(this.componentBody) }, e.prototype.handleActions = function () { var t = this; this.handleSearchInput(), this.items.forEach(function (e, n) { t.handleItemEvents(e, n) }) }, e.prototype.getComponent = function () { return this.assemble(), this.handleActions(), this.container }, e.prototype.triggerContainerEvent = function (t, e) { $(this.container).trigger(t, { value: e, options: this.componentOptions }) }, e.prototype.handleItemEvents = function (t, e) { var n = $(t), i = n.find("input:text"), o = n.find("input:checkbox"), a = n.find('[data-role="edit"]').first(), r = n.find('[data-role="accept"]').first(), s = n.find('[data-role="delete"]').first(), c = n.find('[data-role="undo"]').first(); this.handleItemDelete(s, e, n), this.handleItemEdit({ editButton: a, acceptButton: r, deleteButton: s, undoButton: c }, i, o, n), this.handleItemSave({ editButton: a, acceptButton: r, deleteButton: s, undoButton: c }, i, o, e, n), this.handleItemRevert(c), this.handleItemSelect(n) }, e.prototype.handleItemDelete = function (t, e, n) { var i = this; t.on("click", function () { i.disableItemEditing(), n.addClass("deleting-item"), i.actionPromises.delete(i.valuesArray[e], i.componentOptions).then(function () { n[0].remove() }).catch(function () { n.removeClass("deleting-item") }) }) }, e.prototype.handleItemSave = function (t, e, n, i, o) { var a = this; t.acceptButton.on("click", function () { o.addClass("saving-item"); var r = { id: a.valuesArray[i].id, value: e.val().toString().trim() }; a.actionPromises.update(r, a.componentOptions).then(function () { a.disableItemEditing(), t.acceptButton.blur(), a.inputInitialValue = null }).catch(function () { a.enableItemEditing(o, e, n) }).finally(function () { o.removeClass("saving-item") }) }) }, e.prototype.handleItemRevert = function (t) { var e = this; t.on("click", function () { e.revertCurrentlyEditedItem(), t.blur() }) }, e.prototype.handleItemSelect = function (t) { var e = this; t.on("click", function (n) { var i = t.find("input:checkbox"), o = $(n.target); o.is(".item") || o.parent(".item").length ? (e.currentlyEditedItem && e.revertCurrentlyEditedItem(), i.prop("checked", !i.prop("checked")), e.emmitValueChangeEvent(t, i)) : o.is("input:checkbox") && (e.currentlyEditedItem && e.revertCurrentlyEditedItem(), e.emmitValueChangeEvent(t, i)) }) }, e.prototype.emmitValueChangeEvent = function (t, e) { this.triggerContainerEvent("selectValueChange", { changedValue: { id: t.data("id"), checked: e.prop("checked") }, options: this.componentOptions }) }, e.prototype.handleSearchInput = function () { var t = this; $(this.searchBar).on("keyup", function (e) { var n = $(e.currentTarget).find("input"), i = n.val().toString().trim().toLowerCase(), o = $(t.componentBody); t.isThereAnExactMatchForItem = !1; var a = 0; o.find(".item:not(.add-item)").filter(function (t, e) { var n = $(e), o = n.find("input:text").val(), r = o.toString().toLowerCase().indexOf(i) > -1; return o.toString().toLowerCase() === i && a++ , r ? n.removeClass("display-none") : n.addClass("display-none"), null }), t.isThereAnExactMatchForItem = !!a, t.appendAddButton(n, i) }) }, e.prototype.handleActionAdd = function (t) { var e = this; if (this.addButton) { var n = $(this.addButton); n.on("click", function () { var i = t.val().toString().toLowerCase().trim(); e.actionPromises.create(i, e.componentOptions).then(function (t) { var o = e.getItem({ id: t, value: i, checked: !1 }), a = { id: t, value: i, checked: !1 }, r = e.items.push(o); n.addClass("saving-item"), e.valuesArray.push(a), e.componentBody.appendChild(o), e.handleItemEvents(o, r), e.addButton.remove() }).catch(function () { return n.removeClass("saving-item") }) }) } }, e.prototype.revertCurrentlyEditedItem = function () { var t = $(this.currentlyEditedItem).find("input"); this.inputInitialValue && t.val(this.inputInitialValue), this.disableItemEditing() }, e.prototype.disableItemEditing = function () { if (this.currentlyEditedItem) { var t = this.currentlyEditedItem.find("input:checkbox"), e = this.currentlyEditedItem.find("input:text"); t.removeAttr("disabled"), e.blur(), document.getSelection().removeAllRanges(), e.attr("readonly", "readonly"), this.currentlyEditedItem.removeClass("editing-item"), this.currentlyEditedItem = null } }, e.prototype.getItem = function (t) { var e = t.checked ? "checked" : "", n = this.actionPromises.update ? '<button class="mr-1" data-role="edit"><span class="material-icons">edit</span></button>\n               <button data-role="accept" class="editing-only mr-1"><span class="material-icons">checked</span></button>\n               <button data-role="undo" class="editing-only"><span class="material-icons">replay</span></button>' : "", i = this.actionPromises.delete ? '<button data-role="delete"><span class="material-icons">clear</span></button>' : "", o = '<div class="item justify-content-start" data-id="' + t.id + '">\n                                   <div class="custom-control custom-checkbox mr-2">\n                                        <input type="checkbox" class="custom-control-input" id="' + t.id + '"\n                                        ' + e + '>\n                                        <label class="custom-control-label d-flex" for="' + t.id + '">\n                                        </label>\n                                   </div>\n\n                                   <input type="text" readonly value="' + t.value + '">\n                                   ' + n + "\n                                   " + i + "\n                                </div>"; return $(o)[0] }, e.prototype.getItems = function () { var t = this, e = []; return this.valuesArray.forEach(function (n) { var i = t.getItem(n); e.push(i) }), e }, e.prototype.appendAddButton = function (t, e) { !this.isThereAnExactMatchForItem && e.trim().length ? this.addButton || (this.addButton = this.getAddButton(), this.componentBody.prepend(this.addButton), this.handleActionAdd(t)) : null !== this.addButton && (this.addButton.remove(), this.addButton = null) }, e.prototype.handleItemEdit = function (t, e, n, i) { var o = this; t.editButton.on("click", function () { o.inputInitialValue = e.val().toString(), o.enableItemEditing(i, e, n) }) }, e.prototype.enableItemEditing = function (t, e, n) { this.revertCurrentlyEditedItem(), this.currentlyEditedItem = t, n.attr("disabled", "disabled"), t.addClass("editing-item"), e.removeAttr("readonly"), e.select() }, e }(l); class m { constructor(t, e, n) { this.positioningOptions = e, this.target = t, this.filterOptions = n, this.dynamicSelect = $(this.createDynamicSelect())[0], this.appendFilterPopperToBody(), this.removeFilterPopupWhenClickAway() } static bindFilteringToSearchInput(t) { $(t).on("keyup", e => { const n = $(e.currentTarget).find("input").val().toLowerCase().trim(); $(t).closest(".dynamic-select").find(".item").filter(function () { $(this).toggle($(this).text().toLowerCase().indexOf(n) > -1), $(document).trigger("dynamicFilterSearchInput", { value: n }) }) }) } removeFilterPopupWhenClickAway() { $(document).mouseup(t => { $(this.dynamicSelect).is(t.target) || 0 !== $(this.dynamicSelect).has(t.target).length || this.dynamicSelect.remove() }) } appendFilterPopperToBody() { $(document.body).append(this.dynamicSelect), new Popper(this.target, this.dynamicSelect, this.positioningOptions) } createDynamicSelect() { return '<div class="dynamic-select"></div>' } createSearchBar() { return '<div class="search-bar">\n       <input type="text" placeholder="' + this.filterOptions.searchBarPlaceholder + '">       <span class="material-icons bg-transparent">search</span>\n     </div>' } createDynamicSelectBody() { return '<div class="dynamic-select-body"></div>' } } class f extends m { constructor(t, e = [], n = { placement: "bottom-start" }, i) { super(t, n, i), this.valuesArray = e, this.filterOptions = i, this.dynamicSelectBody = $(this.createDynamicSelectBody())[0], this.searchBar = $(this.createSearchBar())[0], this.items = this.createItems(), this.createListFilter(), m.bindFilteringToSearchInput(this.searchBar) } createListFilter() { return this.buildComponent(), this.bindToItemsSelect(this.items, this.dynamicSelect, this.filterOptions), this.container } createItems() { const t = []; return this.valuesArray.forEach(e => { const n = document.createElement("div"); $(n).addClass("item"), $(n).text(e.value), $(n).attr("data-id", e.id), t.push(n) }), t } buildComponent() { this.valuesArray.length >= 5 && this.dynamicSelect.append(this.searchBar), this.items.forEach(t => this.dynamicSelectBody.append(t)), this.dynamicSelect.append(this.dynamicSelectBody) } bindToItemsSelect(t, e, n) { $(t).each((t, i) => { $(i).on("click", function () { $(this).trigger("filterValueChange", { id: $(i).data("id"), value: $(i).text(), options: n }), $(e).remove() }) }) } } class v extends m { constructor(t, e = [], n = { placement: "bottom-start" }, i) { super(t, n, i), this.valuesArray = e, this.filterOptions = i, this.dynamicSelectBody = $(this.createDynamicSelectBody())[0], this.searchBar = $(this.createSearchBar())[0], this.items = this.createItems(), this.selectedItems = this.getInitiallySelectedItems(), this.createFilter(), m.bindFilteringToSearchInput(this.searchBar) } createFilter() { this.buildComponent(), this.bindCheckingOnItemClick(), this.bindToCheckboxTrigger() } createItems() { const t = []; return this.valuesArray.forEach(e => { const n = document.createElement("div"); $(n).addClass("item"), n.append($(this.createCustomCheckbox(e.id, e.value))[0]), this.setCheckboxState(n, e.checked), t.push(n) }), t } setCheckboxState(t, e) { !0 === e ? $(t).find("input").attr("checked", "checked") : $(t).find("input").removeAttr("checked") } createCustomCheckbox(t, e) { return '<div class="custom-control custom-checkbox"><input type="checkbox" class="custom-control-input" id="' + t + '"><label class="custom-control-label" for="' + t + '">' + e + "</label></div>" } buildComponent() { this.valuesArray.length >= 5 && this.dynamicSelect.append(this.searchBar), this.items.forEach(t => this.dynamicSelectBody.append(t)), this.dynamicSelect.append(this.dynamicSelectBody) } bindCheckingOnItemClick() { this.items.forEach(t => { const e = $(t); e.find("label").on("click", t => { t.preventDefault() }), e.on("mouseup", () => { const t = e.find("input"); t.attr("checked", !t.attr("checked")) }) }) } bindToCheckboxTrigger() { this.items.forEach((t, e) => { const n = $(t); n.on("mouseup", () => { const t = n.find("input"), i = t.attr("checked"), o = t.attr("id"); this.selectedItems[e] = "checked" === i ? o : null, this.emitEvent("selectValues", { selected: this.selectedItems.filter(t => t), options: this.filterOptions }), this.emitEvent("filterValueChange", { changedValue: { id: o, checked: "checked" === i }, options: this.filterOptions }) }) }) } emitEvent(t, e = {}) { $(this.dynamicSelect).trigger(t, e) } getInitiallySelectedItems() { const t = []; return this.valuesArray.forEach((e, n) => { e.checked && (t[n] = e.id) }), t } } class g extends m { constructor(t, e = { placement: "bottom-start" }, n) { n.textEmitEventTimeout = n.textEmitEventTimeout || 500, super(t, e, n), this.searchBar = $(this.createSearchBar())[0], $(this.searchBar).find("input").val(n.searchValue), this.createFilter() } createFilter() { this.buildComponent(), this.bindToInput() } buildComponent() { this.dynamicSelect.append(this.searchBar) } emitFilterValueChange(t = {}) { $(this.dynamicSelect).trigger("filterValueChange", t) } bindToInput() { const t = $(this.searchBar).find("input"); let e = 0; t.on("input", () => { clearTimeout(e), e = setTimeout(() => { this.emitFilterValueChange({ value: t.val(), options: this.filterOptions }) }, this.filterOptions.textEmitEventTimeout) }) } } var y = function () { this.create = null, this.update = null, this.delete = null }; var b = function () { function t(t, e) { this.popoverSettings = e, this.overflowIndicators = [], this.table = $(t), this.handleCellActions(), this.handleTableResize() } return t.prototype.updateIndicatorState = function () { this.resetAllIndicators(), this.handleCellActions() }, t.prototype.handleCellActions = function () { var t = this; this.table.find(".data-cell").each(function (e, n) { t.addOverflowIndicator(n) }), this.enableAllPoppovers() }, t.prototype.addOverflowIndicator = function (t) { var e, n = (e = t).scrollHeight > e.clientHeight || e.scrollWidth > e.clientWidth, i = $(t), o = $(this.getOveflowIndicator(i)); n && 0 === i.children().length && (i.parent().append(o), this.overflowIndicators.push({ cell: i, indicator: o })) }, t.prototype.getOveflowIndicator = function (t) { return '<button class="overflow-indicator btn-primary" data-toggle="popover" data-placement="right"\n                        data-content="' + (t ? t.text() : "") + '" data-trigger="focus">\n                    <div class="material-icons">keyboard_arrow_right</div>\n                </button>' }, t.prototype.handleTableResize = function () { var t = this; $(window).on("resize", function () { var e = t.table.outerWidth(); t.tableWidth = t.tableWidth ? t.tableWidth : e, e !== t.tableWidth && (t.resetAllPoppovers(), t.updateIndicatorState(), t.tableWidth = e) }) }, t.prototype.resetAllIndicators = function () { this.overflowIndicators.forEach(function (t) { t.indicator.remove(), t = null }) }, t.prototype.enableAllPoppovers = function () { this.table.find('[data-toggle="popover"]').popover({ trigger: this.popoverSettings && this.popoverSettings.trigger ? this.popoverSettings.trigger : "focus", template: ' <div class="info-tooltip-content popover popover-dismissible" role="tooltip">\n                            <h3 class="popover-header"></h3>\n                            <div class="popover-body"></div>\n                        </div>' }) }, t.prototype.resetAllPoppovers = function () { this.table.find('[data-toggle="popover"]').popover("dispose") }, t }(), C = function () { this.seed = Math.floor(1e5 * Math.random()) }, I = function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function i() { this.constructor = e } t(e, n), e.prototype = null === n ? Object.create(n) : (i.prototype = n.prototype, new i) } }(), k = function (t) { function e(e) { var n = t.call(this) || this; return n.componentOptions = e, n.finalValue = { fromDate: null, toDate: null }, n.componentOptions = n.componentOptions ? n.componentOptions : { format: "dd/mm/yyy", todayHighlight: !0, autoclose: !0 }, n.container = n.getDatePickerContainer(), n.fromContainer = n.getFromContainer(), n.toContainer = n.getToContainer(), n } return I(e, t), e.prototype.assemble = function () { this.container.append(this.fromContainer[0]), this.container.append(this.toContainer[0]) }, e.prototype.handleActions = function () { this.handleDatePickerActions("#date-from-" + this.seed, "fromDate"), this.handleDatePickerActions("#date-to-" + this.seed, "toDate") }, e.prototype.getComponent = function () { return this.assemble(), this.handleActions(), this.container[0] }, e.prototype.getDatePickerContainer = function () { return $('<div class="date-picker-container range"></div>') }, e.prototype.getFromContainer = function () { var t = this.componentOptions && this.componentOptions.fromLabel ? this.componentOptions.fromLabel : "From"; return $(' <div class="date-input">\n                            <label for="date-from-' + this.seed + '" class="text-capitalize">' + t + '</label>\n                            <div class="input-group outline-control br-none inline-editing-input">\n                                <input type="text" class="form-control" id="date-from-' + this.seed + '">\n                                <div class="input-group-append">\n                                    <span class="input-group-text"><span class="material-icons">calendar_today</span></span>\n                                </div>\n                            </div>\n                        </div>') }, e.prototype.getToContainer = function () { var t = this.componentOptions && this.componentOptions.toLabel ? this.componentOptions.toLabel : "To"; return $(' <div class="date-input">\n                            <label for="date-to-' + this.seed + '" class="text-capitalize">' + t + '</label>\n                            <div class="input-group outline-control br-none inline-editing-input">\n                                <input type="text" class="form-control" id="date-to-' + this.seed + '">\n                                <div class="input-group-append">\n                                    <span class="input-group-text"><span class="material-icons">calendar_today</span></span>\n                                </div>\n                            </div>\n                        </div>') }, e.prototype.handleDatePickerActions = function (t, e) { var n = this; $(this.container).find(t).datepicker(this.componentOptions).on("changeDate", function (t) { n.finalValue[e] = t.date, n.emmitEvent("rangeChangeDate", n.finalValue) }) }, e.prototype.emmitEvent = function (t, e) { var n = new CustomEvent(t, { detail: e, bubbles: !1, cancelable: !1 }); this.container[0].dispatchEvent(n) }, e }(C), B = function () { var t = function (e, n) { return (t = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var n in e) e.hasOwnProperty(n) && (t[n] = e[n]) })(e, n) }; return function (e, n) { function i() { this.constructor = e } t(e, n), e.prototype = null === n ? Object.create(n) : (i.prototype = n.prototype, new i) } }(), E = function (t) { function e(e, n, i) { var o = t.call(this, e, n, i) || this; return o.container.addEventListener("rangeChangeDate", function (t) { o.elementData = t.detail }), o } return B(e, t), e.prototype.componentRemoving = function () { var t = this; $(document).on("mouseup", function (e) { if (t.container) { var n = $(".datepicker").last(); $(t.container).is(e.target) || 0 !== $(t.container).has(e.target).length || n.is(e.target) || 0 !== $(e.target).closest(".datepicker").length || (t.emitEvent("closeDatePickerPopper", t.elementData), t.container.remove(), delete t.container, delete t.element, delete t.popper) } }) }, e.prototype.emitEvent = function (t, e) { var n = new CustomEvent(t, { detail: e, bubbles: !1, cancelable: !1 }); return this.container.dispatchEvent(n), n }, e }(c); function A(t, e, n) { var i = new k(e).getComponent(); new E(t, i, n); return i } function S(t) { return { 1001: 1, 1002: 3, 1003: 6, 1004: 12 }[t] || 0 } function x(t, e) { if (!e) return null; var n = null; switch (t.measurementUnitIdReference.name.toLowerCase()) { case "procent": n = parseInt(t.procentGoal); break; case "boolean": n = t.boolGoal; break; case "number": n = parseInt(t.intGoal) }console.log("targetValue"), console.log(n), console.log("record"), console.log(t), console.log("value"), console.log(e); var i = !1; switch (parseInt(t.criteriaIdReference.code)) { case 4001: i = "yes" == e && n; break; case 4002: i = "no" == e && n; break; case 4003: i = parseInt(e) >= n; break; case 4004: i = parseInt(e) <= n }return i ? "kpi-green-cell" : "kpi-red-cell" } function w(t, e, n) { switch (void 0 === e && (e = ""), void 0 === n && (n = ""), t) { case "Number": return '<input class="' + n + ' form-control kpi-value" type="string" value="' + e + '">'; case "Boolean": return '\n                    <select class="' + n + " mdb-select md-form colorful-select dropdown-primary kpi-value\">\n                        <option value=''></option>\n                        <option value='yes' " + ("yes" === e ? "selected" : "") + ">Yes</option>\n                        <option value='no' " + ("no" === e ? "selected" : "") + ">No</option>\n                    </select>"; case "Percentage": case "Procent": return '\n                    <div class="input-group input-type-percentage">\n                        <input class="' + n + ' form-control kpi-value" type="string" value="' + e + '">\n                        <div class="input-group-append">\n                            <span class="input-group-text">%</span>\n                        </div>\n                    </div>\n                ' }return null } var O = function () { function t(t) { this.config = t, this.cssClassMergedCells = "merged-cells", this.tableData = [], this.storedData = [], this.year = null, this.year = t.year, this.tableData = t.tableData, this.storedData = t.storedData, this.htmlId = "table-" + function (t) { void 0 === t && (t = 32); for (var e = [], n = "abcdefghijklmnopqrstuvwxyz0123456789", i = 0; i < t; i++)e.push(n.charAt(Math.floor(Math.random() * n.length))); return e.join("") }(), this.assemble(), this.handleActions() } return t.prototype.getComponentBody = function () { return this.$componentBody }, t.prototype.handleCellDeletion = function () { var t = this; this.$componentBody.on("click", "td .delete-kpi-inscription", function (e) { e.preventDefault(), e.stopPropagation(); var n = $(e.target), i = n.closest("td"), o = i.closest("tr").index(); if (o < 0) return !1; var a = S(t.tableData[o].periodIdReference.code); i.prop("colspan"); if (a <= 0) return !1; n.siblings().find(".kpi-value").val(""), i.attr("colspan", 0), i.removeClass(t.cssClassMergedCells); for (var r = $("<td></td>"), s = a - 1, c = 0; c < s; c++)r.clone().insertAfter(n.closest($("td"))); document.dispatchEvent(new CustomEvent("deleted_kpi_record", { detail: i.data("id") })), i.html(""), i.attr("data-id", ""), i.removeData(), n.remove() }) }, t.prototype.handleCellMargin = function (t) { var e = this; e.$componentBody.on("click", "td", function () { var n = $(this); if (n.children().length > 0 || n.hasClass(e.cssClassMergedCells) || "" != n.html() || n.find("input").length > 0 || n.find("select").length > 0 || n.find(".delete-kpi-inscription").length > 0) return console.log("acest field dehare are valoarea"), !1; var i = n.closest("tr").index(), o = t[i], a = S(o.periodIdReference.code); if (a <= 0) return !1; var r = !0, s = n.nextAll("td"); s.length < a - 1 && (r = !1); var c = s.slice(0, a - 1); if (c.each(function (t, n) { if ($(n).hasClass(e.cssClassMergedCells)) return r = !1, !1 }), !r) return alert(e.config.kpiLocalization.notEnoughCellsForPeriod), !1; n.html(w(o.measurementUnitIdReference.name)), c.remove(), n.attr("colspan", a), n.addClass(e.cssClassMergedCells), n.append('<button class="delete-kpi-inscription"></button>') }) }, t.prototype.handleKPIValueChange = function (t) { var e = this; this.$componentBody.on("keypress", ".kpi-value", function (t) { 13 === t.which && $(this).blur() }), this.$componentBody.on("change", ".kpi-value", function (n) { var i = $(n.target), o = i.closest("tr").index(); i.removeClass("kpi-green-cell kpi-red-cell"), i.addClass(x(t[o], i.val().toString())), e.getCompletedData() }) }, t.prototype.getCompletedData = function () { var t = this.$componentBody.find(".kpi-green-cell,.kpi-red-cell"), e = { year: this.year, records: [] }; return this.extendCellColspanAccordingToCurrentPeriod(t, e), e }, t.prototype.extendCellColspanAccordingToCurrentPeriod = function (t, e) { t.each(function (t, n) { var i = $(n), o = i.closest("td"), a = parseInt(o.attr("colspan")), r = o.index(), s = r + a - 1; e.records.push({ firstMonthIndex: r, lastMonthIndex: s, value: i.val(), type: i.data("type") }) }) }, t.prototype.adjustRowHeights = function (t) { var e = this; t.forEach(function (t, n) { e.$componentBody.find("tbody tr").eq(n - 1).height(t) }) }, t.prototype.assemble = function () { var t = this, e = parseInt(this.year.toString()), n = Array.apply(null, { length: 12 }).map(Number.call, Number), i = this.tableData.map(function (i) { var o = []; if (0 === t.storedData.length) return o = n.map(function () { return "<td></td>" }), '<tr data-id="' + i.id + '">' + o.join("") + "</tr>"; var a = t.storedData.filter(function (t) { var n = parseInt(t.kpi_year); return t.id_kpi === i.id && n === e && n > 0 }); a.sort(function (t, e) { return t.first_month < e.first_month ? -1 : t.first_month > e.first_month ? 1 : 0 }); var r = 1; for (a.forEach(function (t) { for (; r < t.first_month;)o.push('<td data-id="' + t.id + '" data-temp="' + JSON.stringify(a) + '"></td>'), r++; var e = parseInt(t.last_month) - parseInt(t.first_month) + 1; o.push('<td data-id="' + t.id + '" colspan="' + e + '" data-temp="' + JSON.stringify(a) + '">' + function (t) { var e = t.hasOwnProperty("id_kpiReference") ? x(i, t.kpi_value) : ""; return w((t.hasOwnProperty("measurementUnitIdReference") ? t.measurementUnitIdReference : i.measurementUnitIdReference).name, t.kpi_value, e) }(t) + '<button class="delete-kpi-inscription"></button></td>'), r += e }); r <= 12;)o.push('<td data-temp="' + JSON.stringify(a) + '"></td>'), r++; return '<tr data-id="' + i.id + '">' + o.join("") + "</tr>" }); this.$componentBody = $('<table data-stored="' + JSON.stringify(this.storedData) + '" id="' + this.htmlId + '" class="table table-striped mb-4 bg-white table-bordered table-kpi-year">\n            <thead>\n                <tr role="row">\n                    <th colspan="12" class=" ">' + this.year + '</th>\n                </tr>\n                <tr class="months-row">\n                    <th class="month-th">' + this.config.kpiLocalization.months[0] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[1] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[2] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[3] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[4] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[5] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[6] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[7] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[8] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[9] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[10] + '</th>\n                    <th class="month-th">' + this.config.kpiLocalization.months[11] + "</th>\n                </tr>\n            </thead>\n            <tbody>" + i.join("") + "</tbody>\n        </table>") }, t.prototype.getComponent = function () { }, t.prototype.handleActions = function () { var t = this.tableData; this.handleKPIValueChange(t), this.handleCellMargin(t), this.handleCellDeletion() }, t }(); var P = function () { function t() { } return t.getPageData = function () { return new Promise(function (t, e) { $.ajax({ url: "../../ajax-responses/temp_kpi.json", type: "GET", dataType: "json", success: function (e, n, i) { t(e) }, error: function (t, n, i) { e(i) } }) }) }, t }(), _ = function () { this.notEnoughCellsForPeriod = "Numărul de celule disponibile este insuficient pentru a face merge", this.months = ["Ian", "Feb", "Mar", "Apr", "Mai", "Iun", "Iul", "Aug", "Sep", "Oct", "Noi", "Dec"] }, T = function (t, e, n) { this.year = t, this.tableData = e, this.storedData = n, this.year = t, this.tableData = e, this.kpiLocalization = new _, this.storedData = n }; $(document).ready(function () { new a, new r; $.Iso = { Tooltip: o, dynamicFilter: function (t, e, n, i, o, a) { return void 0 === o && (o = { searchBarPlaceholder: "Caută/Adaugă", addButtonLabel: "Adaugă" }), void 0 === a && (a = { placement: "bottom-start" }), i || (i = new y), function (t, e, n, i, o, a) { switch (t) { case "list": var r = new p(n, o, i); return new c(e, r.getComponent(), a); case "multi-select": return r = new h(n, o, i), new c(e, r.getComponent(), a); default: return null } }(t, e, n, i, o, a) }, DynamicFilter: function (t, e, n, i, o, a) { return void 0 === o && (o = { searchBarPlaceholder: "Caută/Adaugă", addButtonLabel: "Adaugă" }), void 0 === a && (a = { placement: "bottom-start" }), i || (i = new y), function (t, e, n = [], i = { searchBarPlaceholder: "Caută", addButtonLabel: "Adaugă" }, o = { placement: "bottom-start" }) { switch (t) { case "list": return new f(e, n, o, i); case "multi-select": return new v(e, n, o, i); case "text": return new g(e, o, i); default: return null } }(t, e, n, o) }, InlineEditingCells: function () { return new i }, MultilevelCollapse: r, OverflowIndicator: function (t, e) { return new b(t, e) }, DatePicker: A, KpiConfiguration: T, KpiComponent: function (t) { return new O(t) }, Api: P } }) }]);