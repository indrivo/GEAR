@model ST.Report.Dynamic.Razor.ViewModels.DynamicReportViewModel
@{
	ViewData["Title"] = Model.Id == Guid.Empty ? "Create Dynamic Report" : $"Edit Dynamic Report \"{Model.Name}\"";
}

@section PreScripts
{
	<script src="~/lib/Chart.js/Chart.bundle.min.js"></script>
	<script src="~/lib/Chart.js/Chart.min.js"></script>
}

@section Styles
{
	<link rel="stylesheet" href="~/lib/Chart.js/Chart.min.css" />
	<link rel="stylesheet" href="~/lib/dynamic-reports/report.css" />
}

@section Scripts
{
	<script src="~/lib/dynamic-reports/report.js"></script>
	@if (Model.Id != Guid.Empty)
	{
		<script>
			$(document).ready(function () {
				try {
					var data = @Html.Raw(Model.ReportData);
					$.when(LoadReportData(data)).done(function () {
						LoadFinished = true;
					});
				}
				catch (err) {
					LoadNew();
				}
			 });
		</script>

	}
	else
	{
		<script>
			LoadNew();
		</script>
	}
}
<div class="card mb-3">
	<div class="card-header">
		Data options
	</div>
	<div class="card-block pl-3 pt-2">
		<div class="row">
			<div class="col-2">
				<div class="form-group">
					<label for="tableSelect">Select table:</label>
					<select class="form-control tableSelect" id="tableSelect" data-request-url="@Url.Action("GetTablesAjax", "DynamicReports")"></select>
				</div>
			</div>
			<!--#region Relationships-->
			<div class="col-md-1">
				<div class="form-group">
					<label>Relationships : </label>
					<br />
					<button class="btn btn-info text-white" id="AddRelationship"
							role="button">
						Add Relationship
					</button>
				</div>
			</div>
			<div class="col-6" id="pnlRelationships" data-request-url="@Url.Action("GetTableColumnsAjax", "DynamicReports")"></div>
			<!--#endregion Relationships-->
		</div>
	</div>
</div>


<div class="card mb-3">
	<div class="card-header">
		Display options
		<button class="btn btn-info text-white ml-2" id="AddField" role="button">Add Field</button>
	</div>
	<div class="card-block pl-3 pt-2" style="display:none" id="cbFields">
		<div class="row">
			<div class="col-6" id="pnlFields" data-request-url="@Url.Action("GetAggregateTypes", "DynamicReports")"></div>
		</div>
	</div>
</div>

<div class="card mb-3">
	<div class="card-header">
		Filters and group options
		<button class="btn btn-info text-white ml-2" id="AddFilter" role="button">Add Filter</button>
	</div>
	<div class="card-block pl-3 pt-2" style="display:none" id="cbFilters">
		<div class="row">
			<div class="col-6" id="pnlFilters" data-request-url="@Url.Action("GetFilterTypes", "DynamicReports")"></div>
		</div>
	</div>
</div>

<div class="card mb-3">
	<div class="card-header">
		<div class="row">
			<div class="mt-1 ml-1">
				Charts
			</div>
			<div class="col-md-2">
				<div class="form-group">
					<select class="form-control chartSelector" id="chartSelector" data-request-url="@Url.Action("GetChartTypes", "DynamicReports")">
					</select>
				</div>
			</div>
			<div class="col-md-1">
				<button class="btn btn-info text-white ml-2" id="AddChart" role="button">Add Chart</button>
			</div>
		</div>
	</div>
	<div class="card-block pl-3 pt-2" style="display:none" id="cbCharts">
		<div class="row">
			<div class="col-10" id="pnlCharts" data-request-url="@Url.Action("GetChartFieldTypes", "DynamicReports")">
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="saveReportModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLabel">Save Report</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-12">
						<form>
							<div class="form-group">
								<div class="row">
									<label class="col-md-4"><span class="pull-right">Name</span></label>
									<div class="col-md-1"></div>
									<input class="form-control col-md-6" id="reportName" asp-for="Name" />
									<input type="hidden" id="reportId" asp-for="Id" />
								</div>
								<div class="row mt-2">
									<label class="col-md-4"><span class="pull-right">Folder name</span></label>
									<div class="col-md-1"></div>
									<select id="folderSelector" asp-items="@(new SelectList(ViewBag.Folders, "Id", "Name", Model.DynamicReportFolderId))" class="form-control col-md-6 custom-select"></select>
								</div>
							</div>
							<div class="modal-footer">
								<a class="btn btn-success text-white" id="saveReport" data-request-url="@Url.Action("Save", "DynamicReports")">Save</a>
								<button type="button" class="btn btn-inverse " data-dismiss="modal">Close</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="row ml-1">
	<div class="mt-3 mb-3 mr-2">
		<button class="btn btn-danger m-t-20" id="openReportModal">Save</button>
	</div>
	<div class="mt-3 mb-3">
		<button class="btn btn-info m-t-20" id="runReport" data-request-url="@Url.Action("GetReportData", "DynamicReports")">Run</button>
	</div>
</div>
<div id="queryResultTable">
</div>

<div id="chart-box">

</div>


