@{
    ViewData["Title"] = "Index";
}
@section Styles {
    <link rel="stylesheet" href="~/assets/task-manager.css" asp-append-version="true" />
}
@inject IStringLocalizer Localizer

<div class="task-manager">
    <div class="task-manager-loader justify-content-center align-items-center">
        <div class="lds-dual-ring"></div>
    </div>

    <div class="row task-manager-controls">
        <div class="col-md-2">
            <div class="form-group">
                <select class="form-control task-manager-task-types">
                    <option value="active" selected>@Localizer["system_taskmanager_active"]</option>
                    <option value="assigned">@Localizer["system_taskmanager_assigned"]</option>
                    <option value="deleted">@Localizer["system_taskmanager_deleted"]</option>
                </select>
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-group row align-items-center ml-4">
                <label class="m-0 task-manager-items-per-page-label" for="iems-per-page">@Localizer["system_taskmanager_items_per_page"]</label>
                <select class="task-manager-items-per-page-control form-control w-auto ml-2">
                    <option value="5">5</option>
                    <option value="10" selected>10</option>
                    <option value="20">20</option>
                    <option value="50">50</option>
                </select>
            </div>
        </div>
        <div class="col">
            <button id="add-new-task" class="task-manager-add-new-task btn btn-primary pull-right d-flex align-items-center" data-toggle="modal" data-target="#addTaskModal">
                <i class="material-icons d-block">add</i>
                <span>
                    @Localizer["system_taskmanager_add_task"]
                </span>
            </button>
        </div>
    </div>

    <div class="task-manager-task-list table-responsive">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th class="sortable" data-attribute="TaskNumber">@Localizer["system_taskmanager_task_number"]<span class="sort"></span></th>
                    <th class="sortable" data-attribute="TaskPriority">@Localizer["system_taskmanager_task_priority"]<span class="sort"></span></th>
                    <th>@Localizer["name"]</th>
                    <th>@Localizer["system_taskmanager_task_progress"]</th>
                    <th class="sortable" data-attribute="StartDate" data-sort="ascending">@Localizer["system_taskmanager_start_date"]<span class="sort ascending"></span></th>
                    <th class="sortable" data-attribute="EndDate">@Localizer["system_taskmanager_end_date"]<span class="sort"></span></th>
                    <th class="sortable" data-attribute="Status">@Localizer["system_taskmanager_status"]<span class="sort"></span></th>
                    <th>@Localizer["system_taskmanager_actions"]</th>
                </tr>
            </thead>
            <tbody class="task-manager-task-list-table" id="task-list-table">
                <tr>
                    <td>
                        <span class="col">@Localizer["system_taskmanager_no_tasks"]</span>
                    </td>
                </tr>
            </tbody>
        </table>
        <nav>
            <ul id="task-list-pager" class="task-manager-task-list-pager pagination justify-content-center">
            </ul>
        </nav>
    </div>

    <div class="modal fade modal-confirm-delete-task" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header px-4">
                    <h5 class="modal-title" id="deleteConfirmModalLabel">@Localizer["system_taskmanager_are_you_sure"]<span class="task-name"></span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">@Localizer["system_taskmanager_no"]</button>
                    <button id="submit-task-delete" type="button" class="btn btn-danger text-white">@Localizer["system_taskmanager_yes"]</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-add-task modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-labelledby="addTaskModalLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header px-4">
                    <h5 class="modal-title" id="addTaskModalLabel">@Localizer["system_taskmanager_add_task"]</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="material-icons ">close</span>
                    </button>
                </div>
                <div class="modal-body mx-4 mb-4 p-0">
                    <ul class="nav nav-tabs nav-primary">
                        <li><a class="nav-link initial-tab-click active" data-toggle="tab" href="#add-task-tab">@Localizer["system_taskmanager_task_details"]</a></li>
                        <li><a class="nav-link" data-toggle="tab" href="#add-task-items-tab">@Localizer["system_taskmanager_task_items"]</a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="add-task-tab" class="tab-pane fade in active show">
                            <form id="add-task">
                                <div class="form-group">
                                    <div class="form-group">
                                        <label for="add-task-name">@Localizer["name"]</label>
                                        <input type="text" class="form-control task-name" id="add-task-name" placeholder="@Localizer["name"]" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-description">@Localizer["description"]</label>
                                        <textarea class="form-control task-description ckeditor" id="add-task-description" type="text" rows="3" required></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-start-date">@Localizer["system_taskmanager_start_date"]</label>
                                        <input type="date" id="add-task-start-date" class="form-control task-start-date" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-end-date">@Localizer["system_taskmanager_end_date"]</label>
                                        <input type="date" id="add-task-end-date" class="form-control task-end-date" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-users">@Localizer["user"]</label>
                                        <select id="add-task-users" class="form-control task-users" required>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-priority">@Localizer["system_taskmanager_task_priority"]</label>
                                        <select id="add-task-priority" class="form-control task-priority" required>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-status">@Localizer["status"]</label>
                                        <select id="add-task-status" class="form-control task-status" required>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="add-task-status">@Localizer["system_taskmanager_upload_files"]</label>
                                        <div class="add-task-uploaded-files mb-2">
                                            <div class="file-list">
                                            </div>
                                        </div>
                                        <input class="task-files" name="taskFiles" type="file" size="1" multiple />
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="add-task-items-tab" class="tab-pane fade">
                            <div class="task-items-add-task">
                            </div>
                            <form id="add-task-item-add-task">
                                <div class="form-group d-flex">
                                    <input type="text" class="form-control" id="new-task-item-name-add-task" placeholder="@Localizer["system_taskmanager_add_task_item"]" required>
                                    <button class="btn btn-success py-0 px-2" id="add-new-task-item-add-task" type="submit" form="add-task-item-add-task">
                                        <i class="material-icons d-block">add</i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="align-self-end pb-4 pr-4">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="submit-add-task btn btn-success text-white" form="add-task">@Localizer["system_taskmanager_save_task"]</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal modal-task-details fade" id="detailsTaskModal" tabindex="-1" role="dialog" aria-labelledby="detailsTaskLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header px-4">
                    <h5 class="modal-title" id="detailsTaskLabel">@Localizer["system_taskmanager_task"]<span class="ml-2 task-number">#000000</span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="material-icons ">close</span>
                    </button>
                </div>
                <div class="modal-body mx-4 mb-4 p-0">
                    <ul class="nav nav-tabs nav-primary">
                        <li><a class="nav-link initial-tab-click active" data-toggle="tab" href="#details-tab">@Localizer["system_taskmanager_task_details"]</a></li>
                        <li><a class="nav-link" data-toggle="tab" href="#task-items-tab">@Localizer["system_taskmanager_task_items"]</a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="details-tab" class="tab-pane fade in active show">
                        </div>
                        <div id="task-items-tab" class="tab-pane fade">
                            <div class="task-items">

                            </div>
                            <form id="add-task-item">
                                <div class="form-group d-flex">
                                    <input type="text" class="form-control" id="new-task-item-name" placeholder="@Localizer["system_taskmanager_add_task_item"]" required>
                                    <button class="btn btn-success py-0 px-2" id="add-new-task-item" type="submit" form="add-task-item">
                                        <i class="material-icons d-block">add</i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-edit-task modal fade" id="editTaskModal" tabindex="-1" role="dialog" aria-labelledby="editTaskModalLabel" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header px-4">
                    <h5 class="modal-title" id="editTaskModalLabel">@Localizer["system_taskmanager_edit_task"]<span class="task-number"></span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="material-icons ">close</span>
                    </button>
                </div>
                <div class="modal-body p-4">
                    <form id="edit-task">
                        <div class="edit-task-form-elements">

                        </div>
                        <div class="pull-right">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">@Localizer["system_taskmanager_close"]</button>
                            <input type="submit" class="btn btn-success text-white" value="@Localizer["system_taskmanager_save_task"]">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script id="taskListTemplate" type="text/x-jsrender">
        <tr class="task priority-{{:~prioritiesList[taskPriority].text}}" data-id="{{:id}}">
            <td class="task-number font-weight-bold text-secondary">
                #{{:taskNumber}}
            </td>
            <td class="priority" data-priority="{{:taskPriority}}">
                <span translate="{{:~prioritiesList[taskPriority].translateKey}}">
                    {{:~prioritiesList[taskPriority].text}}
                </span>
            </td>
            <td>
                <div class="task-label text-primary font-weight-bold">{{:name}}</div>
            </td>
            <td>
                <div class="d-flex justify-content-end">
                    <p class="task-item-count m-0">
                        <span>{{:taskItemsCount[0]}}/{{:taskItemsCount[1]}}</span>
                    </p>
                </div>
                <div class="progress" style="height: 0.5rem">
                    <div class="progress-bar" role="progressbar" style="width: calc(100% * {{:taskItemsCount[0]}} / {{:taskItemsCount[1]}});" aria-valuenow="{{:taskItemsCount[0]}}" aria-valuemin="0" aria-valuemax="{{:taskItemsCount[1]}}}"></div>
                </div>
            </td>
            <td class="start-date">
                <span class="text-muted">{{:startDate}}</span>
            </td>
            <td class="end-date">
                <span class="text-muted">{{:startDate}}</span>
            </td>
            <td>
                {{if status == 3}}
                <div class="status status-{{:~statusesList[status].text}} d-flex">
                    <i class="material-icons d-block mr-1">done_outline</i>
                    <span translate="{{:~statusesList[status].translateKey}}">
                        {{:~statusesList[status].text}}
                    </span>
                </div>
                {{else}}
                <div class="status status-{{:~statusesList[status].text}}">
                    <span translate="{{:~statusesList[status].translateKey}}">
                        {{:~statusesList[status].text}}
                    </span>
                </div>
                {{/if}}
            </td>
            <td class="task-actions">
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle d-flex align-items-center" type="button" id="actions-{{:id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="material-icons d-block">settings</i>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="actions-{{:id}}">
                        <a href="" class="dropdown-item view-task d-flex" data-toggle="modal" data-assigned="{{:~assigned}}" data-target="#detailsTaskModal" data-id="{{:id}}">
                            <i class="material-icons d-block mr-2">remove_red_eye</i>
                            <span>@Localizer["system_view_details"]</span>
                        </a>
                        {{if ~deleted}}
                        <a href="" class="dropdown-item restore-task d-flex" data-id="{{:id}}">
                            <i class="material-icons d-block mr-2">restore</i>
                            <span>@Localizer["restore"]</span>
                        </a>
                        {{else !~assigned}}
                        <a href="" class="dropdown-item edit-task d-flex" data-toggle="modal" data-id="{{:id}}" data-task-name="{{:name}}" data-target="#editTaskModal">
                            <i class="material-icons d-block mr-2">edit</i>
                            <span>@Localizer["edit"]</span>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="" class="dropdown-item delete-task d-flex" data-toggle="modal" data-id="{{:id}}" data-task-name="{{:name}}" data-target="#deleteConfirmModal">
                            <i class="material-icons d-block mr-2">delete_outline</i>
                            <span>@Localizer["delete"]</span>
                        </a>
                        {{/if}}
                    </div>
                </div>
            </td>
        </tr>
    </script>

    <script id="taskItemsTemplate" type="text/x-jsrender">
        <div class="task-item" data-id="{{:id}}">
            <div class="custom-control custom-checkbox">
                <input type="checkbox" class="task-item-status custom-control-input" id="{{:id}}" data-id="{{:id}}" {{if isDone}} checked="{{:isDone}}" {{/if}}>
                <label class="custom-control-label" for="{{:id}}">{{:name}}</label>
                <button class="task-item-delete btn btn-outline-danger p-0 pull-right" data-id="{{:id}}">
                    <i class="material-icons d-block">close</i>
                </button>
            </div>
            <hr class="my-3">
        </div>
    </script>

    <script id="taskItemsAddTaskTemplate" type="text/x-jsrender">
        <div class="task-item">
            <div class="task-item-wrapper d-flex align-items-center">
                <label class="m-0 task-item-name" data-task-name="{{:name}}">{{:name}}</label>
                <button class="task-item-delete btn btn-outline-danger p-0 ml-auto">
                    <i class="material-icons d-block">close</i>
                </button>
            </div>
            <hr class="my-3">
        </div>
    </script>

    <script id="taskEditTemplate" type="text/x-jsrender">
        <div class="form-group">
            <label for="edit-task-name">@Localizer["name"]</label>
            <input type="text" class="form-control task-name" id="edit-task-name" placeholder="@Localizer["name"]" required value="{{:name}}">
        </div>
        <div class="form-group">
            <label for="edit-task-description">@Localizer["description"]</label>
            <textarea class="form-control task-description ckeditor" id="edit-task-description" type="text" rows="3" required>{{:description}}</textarea>
        </div>
        <div class="form-group">
            <label for="edit-task-start-date">@Localizer["system_taskmanager_start_date"]</label>
            <input type="date" id="edit-task-start-date" class="form-control task-start-date" required value="{{:~startDateF}}">
        </div>
        <div class="form-group">
            <label for="edit-task-end-date">@Localizer["system_taskmanager_end_date"]</label>
            <input type="date" id="edit-task-end-date" class="form-control task-end-date" required value="{{:~endDateF}}">
        </div>
        <div class="form-group">
            <label for="edit-task-users">@Localizer["user"]</label>
            <select id="edit-task-users" class="form-control task-users" required>
            </select>
        </div>
        <div class="form-group">
            <label for="edit-task-priority">@Localizer["system_taskmanager_task_priority"]</label>
            <select id="edit-task-priority" class="form-control task-priority" required>
            </select>
        </div>
        <div class="form-group">
            <label for="edit-task-status">@Localizer["system_taskmanager_status"]</label>
            <select id="add-task-status" class="form-control task-status" required>
            </select>
        </div>
        <div class="form-group">
            <label for="edit-task-status">@Localizer["system_taskmanager_task_files"]</label>
            <div class="add-task-uploaded-files mb-2">
                <div class="file-list">
                </div>
            </div>
            <input class="task-files" name="taskEditFiles" type="file" size="1" />
        </div>
    </script>

    <script id="taskDetailsTemplate" type="text/x-jsrender">
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["name"]</label>
            <span>
                {{:name}}
            </span>
        </div>
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["description"]</label>
            <span>
                {{:description}}
            </span>
        </div>
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["system_taskmanager_start_date"]</label>
            <span>
                {{:startDate}}
            </span>
        </div>
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["system_taskmanager_end_date"]</label>
            <span>
                {{:endDate}}
            </span>
        </div>
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["user"]</label>
            <span>
                {{:~user.text}}
            </span>
        </div>
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["system_taskmanager_task_priority"]</label>
            <span translate="{{:~prioritiesList[taskPriority].translateKey}}">
                {{:~prioritiesList[taskPriority].text}}
            </span>
        </div>
        {{if ~assigned}}
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["system_taskmanager_status"]</label>
            <select id="edit-assigned-task-status" class="form-control task-status" required>
            </select>
        </div>
        {{else}}
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["system_taskmanager_status"]</label>
            <span translate="{{:~statusesList[status].translateKey}}">
                {{:~statusesList[status].text}}
            </span>
        </div>
        {{/if}}
        {{if files}}
        <div class="form-group">
            <label class="font-weight-bold mr-2">@Localizer["system_taskmanager_task_files"]</label>
            <div class="view-task-files">
            </div>
        </div>
        {{/if}}
    </script>

    <script src="~/assets/TaskManagerPlugins/task-manager-plugin.js" asp-append-version="true"></script>
    <script src="~/assets/TaskManagerPlugins/task-manager.js" asp-append-version="true"></script>
}
