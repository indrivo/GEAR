!function(o){"object"==typeof exports&&"object"==typeof module?o(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],o):o(CodeMirror)}(function(r){"use strict";r.defineOption("foldGutter",!1,function(o,t,e){e&&e!=r.Init&&(o.clearGutter(o.state.foldGutter.options.gutter),o.state.foldGutter=null,o.off("gutterClick",d),o.off("change",a),o.off("viewportChange",p),o.off("fold",s),o.off("unfold",s),o.off("swapDoc",a)),t&&(o.state.foldGutter=new n(function(o){!0===o&&(o={});null==o.gutter&&(o.gutter="CodeMirror-foldgutter");null==o.indicatorOpen&&(o.indicatorOpen="CodeMirror-foldgutter-open");null==o.indicatorFolded&&(o.indicatorFolded="CodeMirror-foldgutter-folded");return o}(t)),f(o),o.on("gutterClick",d),o.on("change",a),o.on("viewportChange",p),o.on("fold",s),o.on("unfold",s),o.on("swapDoc",a))});var u=r.Pos;function n(o){this.options=o,this.from=this.to=0}function l(o,t){for(var e=o.findMarks(u(t,0),u(t+1,0)),r=0;r<e.length;++r)if(e[r].__isFold&&e[r].find().from.line==t)return e[r]}function c(o){if("string"!=typeof o)return o.cloneNode(!0);var t=document.createElement("div");return t.className=o+" CodeMirror-guttermarker-subtle",t}function i(n,o,t){var i=n.state.foldGutter.options,f=o,d=n.foldOption(i,"minFoldSize"),a=n.foldOption(i,"rangeFinder");n.eachLine(o,t,function(o){var t=null;if(l(n,f))t=c(i.indicatorFolded);else{var e=u(f,0),r=a&&a(n,e);r&&r.to.line-r.from.line>=d&&(t=c(i.indicatorOpen))}n.setGutterMarker(o,i.gutter,t),++f})}function f(o){var t=o.getViewport(),e=o.state.foldGutter;e&&(o.operation(function(){i(o,t.from,t.to)}),e.from=t.from,e.to=t.to)}function d(o,t,e){var r=o.state.foldGutter;if(r){var n=r.options;if(e==n.gutter){var i=l(o,t);i?i.clear():o.foldCode(u(t,0),n.rangeFinder)}}}function a(o){var t=o.state.foldGutter;if(t){var e=t.options;t.from=t.to=0,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){f(o)},e.foldOnChangeTimeSpan||600)}}function p(t){var e=t.state.foldGutter;if(e){var o=e.options;clearTimeout(e.changeUpdate),e.changeUpdate=setTimeout(function(){var o=t.getViewport();e.from==e.to||20<o.from-e.to||20<e.from-o.to?f(t):t.operation(function(){o.from<e.from&&(i(t,o.from,e.from),e.from=o.from),o.to>e.to&&(i(t,e.to,o.to),e.to=o.to)})},o.updateViewportTimeSpan||400)}}function s(o,t){var e=o.state.foldGutter;if(e){var r=t.line;r>=e.from&&r<e.to&&i(o,r,r+1)}}});