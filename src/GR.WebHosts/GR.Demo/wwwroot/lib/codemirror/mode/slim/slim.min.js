!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],t):t(CodeMirror)}(function(V){"use strict";V.defineMode("slim",function(r){var m=V.getMode(r,{name:"htmlmixed"}),o=V.getMode(r,"ruby"),e={html:m,ruby:o},a={ruby:"ruby",javascript:"javascript",css:"text/css",sass:"text/x-sass",scss:"text/x-scss",less:"text/x-less",styl:"text/x-styl",coffee:"coffeescript",asciidoc:"text/x-asciidoc",markdown:"text/x-markdown",textile:"text/x-textile",creole:"text/x-creole",wiki:"text/x-wiki",mediawiki:"text/x-mediawiki",rdoc:"text/x-rdoc",builder:"text/x-builder",nokogiri:"text/x-nokogiri",erb:"application/x-erb"},f=function(t){var e=[];for(var n in t)e.push(n);return new RegExp("^("+e.join("|")+"):")}(a),i={commentLine:"comment",slimSwitch:"operator special",slimTag:"tag",slimId:"attribute def",slimClass:"attribute qualifier",slimAttribute:"attribute",slimSubmode:"keyword special",closeAttributeTag:null,slimDoctype:null,lineContinuation:null},u={"{":"}","[":"]","(":")"},t="_a-zA-ZÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�",n=t+"\\-0-9·̀-ͯ‿-⁀",l=new RegExp("^[:"+t+"](?::["+n+"]|["+n+"]*)"),c=new RegExp("^[:"+t+"][:\\."+n+"]*(?=\\s*=)"),s=new RegExp("^[:"+t+"][:\\."+n+"]*"),k=/^\.-?[_a-zA-Z]+[\w\-]*/,d=/^#[_a-zA-Z]+[\w\-]*/;function b(t,e){t.stack={parent:t.stack,style:"continuation",indented:e,tokenize:t.line},t.line=t.tokenize}function z(t){t.line==t.tokenize&&(t.line=t.stack.tokenize,t.stack=t.stack.parent)}function p(n,i){return function(t,e){return t.peek()==n&&1==e.rubyState.tokenize.length?(t.next(),e.tokenize=i,"closeAttributeTag"):h(t,e)}}function x(n){var i,r=function(t,e){if(1==e.rubyState.tokenize.length&&!e.rubyState.context.prev){if(t.backUp(1),t.eatSpace())return e.rubyState=i,(e.tokenize=n)(t,e);t.next()}return h(t,e)};return function(t,e){return i=e.rubyState,e.rubyState=V.startState(o),e.tokenize=r,h(t,e)}}function h(t,e){return o.token(t,e.rubyState)}function y(t,e){return t.match(/^#\{/)?(e.tokenize=p("}",e.tokenize),null):(n=t,i=e,r=/[^\\]#\{/,o=1,a=m.token(t,e.htmlState),k=n.current(),-1<(d=k.search(r))&&(i.tokenize=(u=n.pos,l=i.tokenize,c=a,s=function(t,e){return e.tokenize=l,t.pos<u?(t.pos=u,c):e.tokenize(t,e)},function(t,e){return e.tokenize=s,l(t,e)}),n.backUp(k.length-d-o)),a);var n,i,r,o,a,u,l,c,s,k,d}function S(o){return function(t,e){var n,i,r=(i=e,(n=t).match(/^\\$/)?"lineContinuation":y(n,i));return t.eol()&&(e.tokenize=o),r}}function w(t,e,n){return e.stack={parent:e.stack,style:"html",indented:t.column()+n,tokenize:e.line},e.line=e.tokenize=y,null}function g(t,e){return t.skipToEnd(),e.stack.style}function v(t,e){return t.eat(e.stack.endQuote)?(e.line=e.stack.line,e.tokenize=e.stack.tokenize,e.stack=e.stack.parent,null):t.match(s)?(e.tokenize=M,"slimAttribute"):(t.next(),null)}function M(t,e){return t.match(/^==?/)?(e.tokenize=C,null):v(t,e)}function C(t,e){var n=t.peek();return'"'==n||"'"==n?(e.tokenize=_(n,"string",!0,!1,v),t.next(),e.tokenize(t,e)):"["==n?x(v)(t,e):t.match(/^(true|false|nil)\b/)?(e.tokenize=v,"keyword"):x(v)(t,e)}function E(t,e){if(t.match(/^#\{/))return e.tokenize=p("}",e.tokenize),null;var n=new V.StringStream(t.string.slice(e.stack.indented),t.tabSize);n.pos=t.pos-e.stack.indented,n.start=t.start-e.stack.indented,n.lastColumnPos=t.lastColumnPos-e.stack.indented,n.lastColumnValue=t.lastColumnValue-e.stack.indented;var i=e.subMode.token(n,e.subState);return t.pos=n.pos+e.stack.indented,i}function A(t,e){return e.stack.indented=t.column(),e.line=e.tokenize=E,e.tokenize(t,e)}function L(t){return e.hasOwnProperty(t)?e[t]:e[t]=function(t){var e=a[t],n=V.mimeModes[e];if(n)return V.getMode(r,n);var i=V.modes[e];return i?i(r,{name:e}):V.getMode(r,"null")}(t)}function $(t,e){return t.skipToEnd(),"slimDoctype"}function T(t,e){var n,i,r,o,a,u;if("<"==t.peek())return(e.tokenize=S(e.tokenize))(t,e);if(t.match(/^[|']/))return w(t,e,1);if(t.match(/^\/(!|\[\w+])?/))return n=t,(i=e).stack={parent:i.stack,style:"comment",indented:i.indented+1,tokenize:i.line},(i.line=g)(n,i);if(t.match(/^(-|==?[<>]?)/))return e.tokenize=(r=t.column(),a=t.column(),u=h,o=function(t,e){z(e);var n=u(t,e);return t.eol()&&t.current().match(/,$/)&&b(e,a),n},function(t,e){if(z(e),t.match(/^\\$/))return b(e,r),"lineContinuation";var n=o(t,e);return t.eol()&&t.current().match(/(?:^|[^\\])(?:\\\\)*\\$/)&&t.backUp(1),n}),"slimSwitch";if(t.match(/^doctype\b/))return e.tokenize=$,"keyword";var l,c,s,k,d=t.match(f);return d?(l=d[1],c=e,s=L(l),k=V.startState(s),c.subMode=s,c.subState=k,c.stack={parent:c.stack,style:"sub",indented:c.indented+1,tokenize:c.line},c.line=c.tokenize=A,"slimSubmode"):j(t,e)}function U(t,e){return e.startOfLine?T(t,e):j(t,e)}function j(t,e){return t.eat("*")?(e.tokenize=x(O),null):t.match(l)?(e.tokenize=O,"slimTag"):R(t,e)}function O(t,e){return t.match(/^(<>?|><?)/)?(e.tokenize=R,null):R(t,e)}function R(t,e){return t.match(d)?(e.tokenize=R,"slimId"):t.match(k)?(e.tokenize=R,"slimClass"):q(t,e)}function q(t,e){return t.match(/^([\[\{\(])/)?(n=e,i=u[RegExp.$1],r=q,n.stack={parent:n.stack,style:"wrapper",indented:n.indented+1,tokenize:r,line:n.line,endQuote:i},n.line=n.tokenize=v,null):t.match(c)?(e.tokenize=I,"slimAttribute"):"*"==t.peek()?(t.next(),e.tokenize=x(D),null):D(t,e);var n,i,r}function I(t,e){return t.match(/^==?/)?(e.tokenize=P,null):q(t,e)}function P(t,e){var n=t.peek();return'"'==n||"'"==n?(e.tokenize=_(n,"string",!0,!1,q),t.next(),e.tokenize(t,e)):"["==n?x(q)(t,e):":"==n?x(Z)(t,e):t.match(/^(true|false|nil)\b/)?(e.tokenize=q,"keyword"):x(q)(t,e)}function Z(t,e){return t.backUp(1),t.match(/^[^\s],(?=:)/)?(e.tokenize=x(Z),null):(t.next(),q(t,e))}function _(o,a,u,l,c){return function(t,e){z(e);var n=0==t.current().length;if(t.match(/^\\$/,n))return n?(b(e,e.indented),"lineContinuation"):a;if(t.match(/^#\{/,n))return n?(e.tokenize=p("}",e.tokenize),null):a;for(var i,r=!1;null!=(i=t.next());){if(i==o&&(l||!r)){e.tokenize=c;break}if(u&&"#"==i&&!r&&t.eat("{")){t.backUp(2);break}r=!r&&"\\"==i}return t.eol()&&r&&t.backUp(1),a}}function D(t,e){return t.match(/^==?/)?(e.tokenize=h,"slimSwitch"):t.match(/^\/$/)?(e.tokenize=U,null):t.match(/^:/)?(e.tokenize=j,"slimSwitch"):(w(t,e,0),e.tokenize(t,e))}var Q={startState:function(){return{htmlState:V.startState(m),rubyState:V.startState(o),stack:null,last:null,tokenize:U,line:U,indented:0}},copyState:function(t){return{htmlState:V.copyState(m,t.htmlState),rubyState:V.copyState(o,t.rubyState),subMode:t.subMode,subState:t.subMode&&V.copyState(t.subMode,t.subState),stack:t.stack,last:t.last,tokenize:t.tokenize,line:t.line}},token:function(t,e){if(t.sol())for(e.indented=t.indentation(),e.startOfLine=!0,e.tokenize=e.line;e.stack&&e.stack.indented>e.indented&&"slimSubmode"!=e.last;)e.line=e.tokenize=e.stack.tokenize,e.stack=e.stack.parent,e.subMode=null,e.subState=null;if(t.eatSpace())return null;var n=e.tokenize(t,e);return e.startOfLine=!1,n&&(e.last=n),i.hasOwnProperty(n)?i[n]:n},blankLine:function(t){if(t.subMode&&t.subMode.blankLine)return t.subMode.blankLine(t.subState)},innerMode:function(t){return t.subMode?{state:t.subState,mode:t.subMode}:{state:t,mode:Q}}};return Q},"htmlmixed","ruby"),V.defineMIME("text/x-slim","slim"),V.defineMIME("application/x-slim","slim")});