!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("crystal",function(n){function e(e,t){return new RegExp((t?"":"^")+"(?:"+e.join("|")+")"+(t?"$":"\\b"))}function c(e,t,n){return n.tokenize.push(e),e(t,n)}var s=/^(?:[-+/%|&^]|\*\*?|[<>]{2})/,f=/^(?:[=!]~|===|<=>|[<>=!]=?|[|&]{2}|~)/,l=/^(?:\[\][?=]?)/,m=/^(?:\.(?:\.{2})?|->|[?:])/,h=/^[a-z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/,p=/^[A-Z_\u009F-\uFFFF][a-zA-Z0-9_\u009F-\uFFFF]*/,d=e(["abstract","alias","as","asm","begin","break","case","class","def","do","else","elsif","end","ensure","enum","extend","for","fun","if","include","instance_sizeof","lib","macro","module","next","of","out","pointerof","private","protected","rescue","return","require","select","sizeof","struct","super","then","type","typeof","uninitialized","union","unless","until","when","while","with","yield","__DIR__","__END_LINE__","__FILE__","__LINE__"]),k=e(["true","false","nil","self"]),z=e(["def","fun","macro","class","module","struct","lib","enum","union","do","for"]),F=e(["if","unless","case","while","until","begin","then"]),t=["end","else","elsif","rescue","ensure"],r=e(t),a=["\\)","\\}","\\]"],u=new RegExp("^(?:"+a.join("|")+")$"),b={def:i,fun:i,macro:function(e,t){if(e.eatSpace())return null;var n;if(n=e.match(h)){if("def"==n)return"keyword";e.eat(/[?!]/)}return t.tokenize.pop(),"def"},class:g,module:g,struct:g,lib:g,enum:g,union:g},_={"[":"]","{":"}","(":")","<":">"};function o(e,t){if(e.eatSpace())return null;if("\\"!=t.lastToken&&e.match("{%",!1))return c(y("%","%"),e,t);if("\\"!=t.lastToken&&e.match("{{",!1))return c(y("{","}"),e,t);if("#"==e.peek())return e.skipToEnd(),"comment";var n,r,a;if(e.match(h))return e.eat(/[?!]/),n=e.current(),e.eat(":")?"atom":"."==t.lastToken?"property":d.test(n)?(z.test(n)?"fun"==n&&0<=t.blocks.indexOf("lib")||"def"==n&&"abstract"==t.lastToken||(t.blocks.push(n),t.currentIndent+=1):"operator"!=t.lastStyle&&t.lastStyle||!F.test(n)?"end"==n&&(t.blocks.pop(),t.currentIndent-=1):(t.blocks.push(n),t.currentIndent+=1),b.hasOwnProperty(n)&&t.tokenize.push(b[n]),"keyword"):k.test(n)?"atom":"variable";if(e.eat("@"))return"["==e.peek()?c(x("[","]","meta"),e,t):(e.eat("@"),e.match(h)||e.match(p),"variable-2");if(e.match(p))return"tag";if(e.eat(":"))return e.eat('"')?c(I('"',"atom",!1),e,t):e.match(h)||e.match(p)||e.match(s)||e.match(f)||e.match(l)?"atom":(e.eat(":"),"operator");if(e.eat('"'))return c(I('"',"string",!0),e,t);if("%"!=e.peek())return(n=e.match(/^<<-('?)([A-Z]\w*)\1/))?c((r=n[2],a=!n[1],function(e,t){if(e.sol()&&(e.eatSpace(),e.match(r)))return t.tokenize.pop(),"string";for(var n=!1;e.peek();)if(n)e.next(),n=!1;else{if(e.match("{%",!1))return t.tokenize.push(y("%","%")),"string";if(e.match("{{",!1))return t.tokenize.push(y("{","}")),"string";if(a&&e.match("#{",!1))return t.tokenize.push(x("#{","}","meta")),"string";n=a&&"\\"==e.next()}return"string"}),e,t):e.eat("'")?(e.match(/^(?:[^']|\\(?:[befnrtv0'"]|[0-7]{3}|u(?:[0-9a-fA-F]{4}|\{[0-9a-fA-F]{1,6}\})))/),e.eat("'"),"atom"):e.eat("0")?(e.eat("x")?e.match(/^[0-9a-fA-F]+/):e.eat("o")?e.match(/^[0-7]+/):e.eat("b")&&e.match(/^[01]+/),"number"):e.eat(/^\d/)?(e.match(/^\d*(?:\.\d+)?(?:[eE][+-]?\d+)?/),"number"):e.match(s)?(e.eat("="),"operator"):e.match(f)||e.match(m)?"operator":(n=e.match(/[({[]/,!1))?c(x(n=n[0],_[n],null),e,t):e.eat("\\")?(e.next(),"meta"):(e.next(),null);var u,i="string",o=!0;if(e.match("%r"))i="string-2",u=e.next();else if(e.match("%w"))o=!1,u=e.next();else if(e.match("%q"))o=!1,u=e.next();else{if(!(u=e.match(/^%([^\w\s=])/)))return e.match(/^%[a-zA-Z0-9_\u009F-\uFFFF]*/)?"meta":"operator";u=u[1]}return _.hasOwnProperty(u)&&(u=_[u]),c(I(u,i,o),e,t)}function x(r,a,u,i){return function(e,t){if(!i&&e.match(r))return t.tokenize[t.tokenize.length-1]=x(r,a,u,!0),t.currentIndent+=1,u;var n=o(e,t);return e.current()===a&&(t.tokenize.pop(),t.currentIndent-=1,n=u),n}}function y(n,r,a){return function(e,t){return!a&&e.match("{"+n)?(t.currentIndent+=1,t.tokenize[t.tokenize.length-1]=y(n,r,!0),"meta"):e.match(r+"}")?(t.currentIndent-=1,t.tokenize.pop(),"meta"):o(e,t)}}function i(e,t){return e.eatSpace()?null:(e.match(h)?e.eat(/[!?]/):e.match(s)||e.match(f)||e.match(l),t.tokenize.pop(),"def")}function g(e,t){return e.eatSpace()?null:(e.match(p),t.tokenize.pop(),"def")}function I(a,u,i){return function(e,t){for(var n=!1;e.peek();)if(n)e.next(),n=!1;else{if(e.match("{%",!1))return t.tokenize.push(y("%","%")),u;if(e.match("{{",!1))return t.tokenize.push(y("{","}")),u;if(i&&e.match("#{",!1))return t.tokenize.push(x("#{","}","meta")),u;var r=e.next();if(r==a)return t.tokenize.pop(),u;n=i&&"\\"==r}return u}}return{startState:function(){return{tokenize:[o],currentIndent:0,lastToken:null,lastStyle:null,blocks:[]}},token:function(e,t){var n=t.tokenize[t.tokenize.length-1](e,t),r=e.current();return n&&"comment"!=n&&(t.lastToken=r,t.lastStyle=n),n},indent:function(e,t){return t=t.replace(/^\s*(?:\{%)?\s*|\s*(?:%\})?\s*$/g,""),r.test(t)||u.test(t)?n.indentUnit*(e.currentIndent-1):n.indentUnit*e.currentIndent},fold:"indent",electricInput:e(a.concat(t),!0),lineComment:"#"}}),e.defineMIME("text/x-crystal","crystal")});