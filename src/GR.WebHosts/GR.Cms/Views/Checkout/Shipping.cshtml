@model GR.Orders.Abstractions.ViewModels.CheckoutViewModels.CheckoutShippingViewModel

@{
	ViewData["Title"] = "Checkout";

	Guid? defaultAddress = null;
}

@section Styles {
	<style>
		.list-group {
			list-style: none;
		}

		.adress-item > label {
			cursor: pointer;
		}

		.custom-control-label {
			line-height: 1;
		}

			.custom-control-label::before,
			.custom-control-label::after {
				top: 0;
				width: 20px;
				height: 20px;
			}

		.weight-600 {
			font-weight: 600;
		}

		.fz-16 {
			font-size: 16px;
		}

		.w-130px {
			width: 130px;
			display: inline-block;
		}

		.ml-32px {
			margin-left: 32px;
		}

		.mt-38px {
			margin-top: 38px;
		}

		.adress-item:not(:last-child) > label {
			border-bottom: 1px solid #D8DCE0;
		}

		.payment-actions {
			bottom: 0;
			left: 0px;
			width: 100vw;
			padding-left: 60px;
			background-color: white;
		}

		.button-border {
			border: 1px solid #D3D4D7;
			border-radius: 4px;
		}

		.btn-cancel-order {
			color: #707070;
		}

		.btn-payment,
		.btn-cancel-order {
			font-size: 1rem;
		}

		thead {
			background-color: white;
		}

		.table tbody tr td,
		.table thead tr th {
			color: #081018;
			padding: 0 !important;
			padding-top: 7px !important;
			border: 0;
		}

		.table tbody tr td.pt-4 {
			padding-top: 1em !important;
		}

		.table tbody .product-item:last-child td{
			padding-bottom: 1em !important;
		}

		.table tbody tr td.pb-4 {
			padding-bottom: 1em !important;
		}

		.border-top-row {
			border-top: 1px solid #D8DCE0;
		}
	</style>
}

<div class="row">
	<div class="col-md-5">
		<div class="card p-4">
			<h2 class="w-400">@Localizer["system_billing_address"]</h2>
			<ul class="list-group">
				@foreach (var address in Model.Addresses)
				{
					if (address.IsDefault)
					{
						defaultAddress = address.Id;
					}

					<li class="adress-item">
						<label for="a_@address.Id" class="w-100 m-0 pt-4 pb-4">
							<div class="custom-control custom-radio d-flex align-items-center weight-600">
								<input type="radio" @(address.IsDefault ? "checked='checked'" : "") id="a_@address.Id" name="customRadio" class="custom-control-input billing-address" value="@address.Id">
								<label class="custom-control-label ml-2"><span class="w-130px">@Localizer["system_city"]: </span>@address.ContactName</label>
							</div>

							<div class="address-data ml-32px">
								<div class="mt-2">
									<span class="w-130px">@Localizer["user_address_line_1"]:</span>
									@address.AddressLine1
								</div>
								<div class="mt-2">
									<span class="w-130px">@Localizer["user_address_line_2"]:</span>
									@address.AddressLine2
								</div>
								<div class="mt-2">
									<span class="w-130px">@Localizer["system_phone"]:</span>
									@address.Phone
								</div>
								<div class="mt-2">
									<span class="w-130px">@Localizer["user_postal_code"]:</span>
									@address.ZipCode
								</div>
							</div>
						</label>
					</li>
				}
			</ul>
		</div>

	</div>
	<div class="col-md-3">
		<div class="card h-100 p-4">
			<partial name="_OrderSummaryPartialView" model="@Model.Order" />
		</div>
	</div>
</div>

<div class="position-fixed payment-actions py-2">
	<form asp-action="Shipping">
		@Html.HiddenFor(x => x.Order.Id)
		<input asp-for="BillingAddressId" type="hidden" value="@defaultAddress" />
		<input asp-for="ShipmentAddress" type="hidden" value="@defaultAddress" />

		<div asp-validation-summary="ModelOnly" class="text-danger"></div>
		<div class="pull-left d-flex h-100 pl-3 py-2">
			<a id="cancel-order" href="#" class="btn-cancel-order btn btn-block btn-inverse button-border d-flex align-items-center py-2 px-3">
				<svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 14 14">
					<path id="Icon" d="M245,3448a7,7,0,1,1,7-7A7.008,7.008,0,0,1,245,3448Zm0-12.6a5.6,5.6,0,1,0,5.6,5.6A5.606,5.606,0,0,0,245,3435.4Zm-2.513,9.1h0l-.986-.987,2.513-2.513-2.513-2.513.987-.987,2.513,2.513,2.512-2.513.987.987L245.986,3441l2.513,2.513-.987.987L245,3441.986l-2.513,2.513Z" transform="translate(-238 -3434)" fill="rgba(0,0,0,0.6)" />
				</svg>
				@Localizer["system_cancel_order"]
			</a>
			<button type="submit" class="btn-payment btn btn-block mt-0 ml-2 btn-primary d-flex align-items-center py-2 px-3">
				<svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="16.001" height="16" viewBox="0 0 16.001 16">
					<path id="Icon" d="M8,16a8,8,0,1,1,8-8A8.009,8.009,0,0,1,8,16ZM8,1.6A6.4,6.4,0,1,0,14.4,8,6.407,6.407,0,0,0,8,1.6ZM6.4,12h0L3.2,8.8,4.328,7.672,6.4,9.736l5.272-5.272L12.8,5.6,6.4,12Z" transform="translate(0)" fill="#fff" />
				</svg>
				@Localizer["system_payment"]
			</button>
		</div>
	</form>
</div>


@section Scripts{
	@{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
	<script>
		$(document).ready(function () {
			const toast = new ToastNotifier();
			$("#cancel-order").on("click", function () {
                $.ajax({
                    method: "delete",
					url: "/api/Orders/CancelOrder",
					data: {
						orderId: "@Model.Order.Id"
					},
					success: function (response) {
						if (response.is_success) {
							toast.notifySuccess("Info", "Order was canceled");
							setTimeout(function () {
								location.href = "/Orders/MyOrders";
							}, 300);
						} else {
							toast.notifyErrorList(response.error_keys);
						}
					},
					error: function () {
						toast.notifyErrorList("Error");
					}
				});
            });

            $(".billing-address").on("change", function () {
                $("#BillingAddressId").val($(this).val());
                $("#ShipmentAddress").val($(this).val());
			});

			//adjustPaymentActionWidth(60);

			//$('.sidebar.collapsed').mouseover(function () {
			//	adjustPaymentActionWidth(300);
			//}).mouseleave(function () {
			//	adjustPaymentActionWidth(60);
			//});

			//$('.toggle-sidebar').click(function () {
			//	adjustPaymentActionWidth();
			//});

			//function adjustPaymentActionWidth(sidebarWidth) {

			//	const ajustableWidth = $(window).width() - sidebarWidth - 40;

			//	$('.width-ajustable').width(ajustableWidth);

			//}
		});
	</script>
}
