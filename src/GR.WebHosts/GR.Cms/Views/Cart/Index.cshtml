@model GR.ECommerce.Razor.ViewModels.AddToCartViewModel


@{
	ViewData["Title"] = "Cart";
}

<div class="row">

	<div class="col-8">
		<partial name="_TableCartItems" model="@Model" />
		<textarea class="form-control" id="OrderNotes" rows="3" placeholder="Enter order note"></textarea>
	</div>
	<div class="col-3 m-2 border border-light">
		<p>Order summary</p>
		<hr class="style1">

		<div class="col-12 row">
			<div class="col-6">TotalPrice: </div>
			<div class="col-6 text-right"> @Model.CartItems.Sum(s => s.Product?.PriceWithDiscount)</div>
		</div>

		<hr class="style1">

		<button id="checkout" class="btn btn-success">Process to checkout</button>
	</div>

</div>


<script type="text/javascript">
	$(document).ready(function () {
		const toast = new ToastNotifier();
		$("#checkout").on("click", function () {
			const model = {
            cartId: '@Model.Id',
            notes: $("#OrderNotes").val(),
		}

		$.ajax({
			url: '@Url.Action("CreateOrder","Orders")',
			method: 'post',
			data: model,
			success: function(data) {
				if (data.is_success) {
					toast.notifySuccess("Info", "Order was created");
					setTimeout(function () {
						location.href = `/Checkout/Shipping?orderId=${data.result}`;
					}, 500);
				} else {
					toast.notifyErrorList(data.error_keys);
				}
			},
			error: function(error) {
				console.log(error);
			}
		});
		});
	});
</script>